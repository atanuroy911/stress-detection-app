<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stress Level Prediction System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        .loading {
            display: none;
        }
        .loading.show {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Navigation -->
    <nav class="gradient-bg shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <i class="fas fa-brain text-white text-2xl mr-3"></i>
                        <h1 class="text-white text-xl font-bold">Stress Prediction System</h1>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="/" class="text-white hover:text-gray-200 px-3 py-2 rounded-md">
                        <i class="fas fa-home mr-1"></i>Predict
                    </a>
                    <a href="/models" class="text-white hover:text-gray-200 px-3 py-2 rounded-md">
                        <i class="fas fa-chart-line mr-1"></i>Models
                    </a>
                    <div class="text-white bg-white bg-opacity-20 px-3 py-1 rounded-full text-sm">
                        <i class="fas fa-robot mr-1"></i>{{ model_count }} Models
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="gradient-bg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="text-center">
                <h2 class="text-4xl font-bold text-white mb-4">
                    AI-Powered Stress Level Assessment
                </h2>
                <p class="text-xl text-white opacity-90 mb-8">
                    Using {{ model_count }} advanced machine learning algorithms to predict your stress levels
                </p>
                <div class="flex justify-center space-x-6 text-white">
                    <div class="text-center">
                        <i class="fas fa-chart-bar text-3xl mb-2"></i>
                        <p class="text-sm">Regression Models</p>
                    </div>
                    <div class="text-center">
                        <i class="fas fa-layer-group text-3xl mb-2"></i>
                        <p class="text-sm">Classification Models</p>
                    </div>
                    <div class="text-center">
                        <i class="fas fa-project-diagram text-3xl mb-2"></i>
                        <p class="text-sm">Unsupervised Learning</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Input Form -->
            <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                <div class="flex items-center mb-6">
                    <i class="fas fa-user-md text-blue-600 text-2xl mr-3"></i>
                    <h3 class="text-2xl font-bold text-gray-800">Personal Health Assessment</h3>
                </div>
                
                <form id="prediction-form" class="space-y-4">
                    <!-- Basic Information -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Gender</label>
                            <select name="gender" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Age</label>
                            <input type="number" name="age" min="18" max="100" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Occupation</label>
                        <select name="occupation" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Select Occupation</option>
                            <option value="Software Engineer">Software Engineer</option>
                            <option value="Doctor">Doctor</option>
                            <option value="Teacher">Teacher</option>
                            <option value="Nurse">Nurse</option>
                            <option value="Sales Representative">Sales Representative</option>
                            <option value="Manager">Manager</option>
                            <option value="Engineer">Engineer</option>
                            <option value="Lawyer">Lawyer</option>
                            <option value="Salesperson">Salesperson</option>
                            <option value="Accountant">Accountant</option>
                        </select>
                    </div>

                    <!-- Sleep Information -->
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-blue-800 mb-3">Sleep Information</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Sleep Duration (hours)</label>
                                <input type="number" name="sleep_duration" min="3" max="12" step="0.1" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Quality of Sleep (1-10)</label>
                                <input type="number" name="quality_of_sleep" min="1" max="10" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Sleep Disorder</label>
                            <select name="sleep_disorder" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="None">None</option>
                                <option value="Insomnia">Insomnia</option>
                                <option value="Sleep Apnea">Sleep Apnea</option>
                            </select>
                        </div>
                    </div>

                    <!-- Physical Health -->
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-green-800 mb-3">Physical Health</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Physical Activity Level (1-100)</label>
                                <input type="number" name="physical_activity_level" min="1" max="100" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">BMI Category</label>
                                <select name="bmi_category" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Select BMI Category</option>
                                    <option value="Normal">Normal</option>
                                    <option value="Normal Weight">Normal Weight</option>
                                    <option value="Overweight">Overweight</option>
                                    <option value="Obese">Obese</option>
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Heart Rate (bpm)</label>
                                <input type="number" name="heart_rate" min="50" max="150" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Daily Steps</label>
                                <input type="number" name="daily_steps" min="1000" max="30000" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Blood Pressure (e.g., 120/80)</label>
                            <input type="text" name="blood_pressure" pattern="[0-9]{2,3}/[0-9]{2,3}" placeholder="120/80" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="pt-4">
                        <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-3 px-6 rounded-lg hover:from-blue-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
                            <i class="fas fa-brain mr-2"></i>
                            <span class="button-text">Predict Stress Level</span>
                            <span class="loading">
                                <i class="fas fa-spinner fa-spin mr-2"></i>Analyzing...
                            </span>
                        </button>
                    </div>
                </form>
            </div>

            <!-- Results Panel -->
            <div id="results-panel" class="bg-white rounded-xl shadow-lg p-6 card-hover" style="display: none;">
                <div class="flex items-center mb-6">
                    <i class="fas fa-chart-line text-green-600 text-2xl mr-3"></i>
                    <h3 class="text-2xl font-bold text-gray-800">Prediction Results</h3>
                </div>
                
                <div id="results-content"></div>
            </div>

            <!-- Information Panel (when results not shown) -->
            <div id="info-panel" class="bg-white rounded-xl shadow-lg p-6 card-hover">
                <div class="flex items-center mb-6">
                    <i class="fas fa-info-circle text-blue-600 text-2xl mr-3"></i>
                    <h3 class="text-2xl font-bold text-gray-800">How It Works</h3>
                </div>
                
                <div class="space-y-4">
                    <div class="flex items-start">
                        <div class="flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                            <span class="text-blue-600 font-bold">1</span>
                        </div>
                        <div class="ml-4">
                            <h4 class="font-semibold text-gray-800">Data Collection</h4>
                            <p class="text-gray-600">Fill out the health assessment form with your personal information.</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start">
                        <div class="flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                            <span class="text-blue-600 font-bold">2</span>
                        </div>
                        <div class="ml-4">
                            <h4 class="font-semibold text-gray-800">Feature Engineering</h4>
                            <p class="text-gray-600">Advanced algorithms process your data and extract meaningful features.</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start">
                        <div class="flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                            <span class="text-blue-600 font-bold">3</span>
                        </div>
                        <div class="ml-4">
                            <h4 class="font-semibold text-gray-800">ML Prediction</h4>
                            <p class="text-gray-600">Multiple machine learning models analyze your data to predict stress levels.</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start">
                        <div class="flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                            <span class="text-blue-600 font-bold">4</span>
                        </div>
                        <div class="ml-4">
                            <h4 class="font-semibold text-gray-800">Ensemble Result</h4>
                            <p class="text-gray-600">Get comprehensive results from multiple algorithms for accurate prediction.</p>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 p-4 bg-yellow-50 rounded-lg">
                    <div class="flex">
                        <i class="fas fa-exclamation-triangle text-yellow-600 mt-1 mr-3"></i>
                        <div>
                            <p class="text-sm text-yellow-800">
                                <strong>Disclaimer:</strong> This tool is for informational purposes only and should not replace professional medical advice. 
                                If you're experiencing high stress levels, please consult with a healthcare professional.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <h3 class="text-lg font-semibold mb-2">Stress Level Prediction System</h3>
                <p class="text-gray-400">Powered by Advanced Machine Learning Algorithms</p>
                <div class="mt-4 flex justify-center space-x-4">
                    <span class="bg-gray-700 px-3 py-1 rounded-full text-sm">{{ model_count }} ML Models</span>
                    <span class="bg-gray-700 px-3 py-1 rounded-full text-sm">Feature Engineering</span>
                    <span class="bg-gray-700 px-3 py-1 rounded-full text-sm">Real-time Prediction</span>
                </div>
            </div>
        </div>
    </footer>

    <script>
        document.getElementById('prediction-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Show loading state
            const button = e.target.querySelector('button[type="submit"]');
            const buttonText = button.querySelector('.button-text');
            const loading = button.querySelector('.loading');
            
            buttonText.style.display = 'none';
            loading.classList.add('show');
            button.disabled = true;
            
            // Hide info panel and show results panel
            document.getElementById('info-panel').style.display = 'none';
            document.getElementById('results-panel').style.display = 'block';
            
            try {
                // Get form data
                const formData = new FormData(e.target);
                
                // Send prediction request
                const response = await fetch('/predict', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    displayResults(result);
                } else {
                    displayError(result.error || 'An error occurred during prediction');
                }
                
            } catch (error) {
                displayError('Network error: ' + error.message);
            } finally {
                // Reset button state
                buttonText.style.display = 'inline';
                loading.classList.remove('show');
                button.disabled = false;
            }
        });
        
        function displayResults(result) {
            const resultsContent = document.getElementById('results-content');
            
            // Determine stress level color and icon
            const stressAnalysis = result.stress_analysis;
            const stressColor = stressAnalysis.color;
            const stressIcon = stressColor === 'green' ? 'fa-smile' : stressColor === 'yellow' ? 'fa-meh' : 'fa-frown';
            
            let html = `
                <!-- Main Stress Level -->
                <div class="text-center mb-6 p-6 bg-${stressColor}-50 rounded-lg border-l-4 border-${stressColor}-500">
                    <i class="fas ${stressIcon} text-${stressColor}-600 text-4xl mb-3"></i>
                    <h4 class="text-2xl font-bold text-${stressColor}-800 mb-2">${stressAnalysis.level} Stress Level</h4>
                    <p class="text-${stressColor}-700 mb-3">${stressAnalysis.description}</p>
            `;
            
            if (result.ensemble_regression) {
                html += `<div class="text-3xl font-bold text-${stressColor}-800">${result.ensemble_regression}/10</div>`;
            }
            
            html += '</div>';
            
            // Model Results
            html += '<div class="space-y-6">';
            
            // Regression Models
            if (Object.keys(result.regression_predictions).length > 0) {
                html += `
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h5 class="font-semibold text-blue-800 mb-3">
                            <i class="fas fa-chart-line mr-2"></i>Regression Models (Continuous Scale)
                        </h5>
                        <div class="grid grid-cols-2 gap-3">
                `;
                
                for (const [model, prediction] of Object.entries(result.regression_predictions)) {
                    html += `
                        <div class="bg-white p-3 rounded-md">
                            <div class="text-sm text-gray-600">${model}</div>
                            <div class="text-lg font-bold text-blue-800">${prediction}</div>
                        </div>
                    `;
                }
                
                html += '</div></div>';
            }
            
            // Classification Models
            if (Object.keys(result.classification_predictions).length > 0) {
                html += `
                    <div class="bg-purple-50 p-4 rounded-lg">
                        <h5 class="font-semibold text-purple-800 mb-3">
                            <i class="fas fa-layer-group mr-2"></i>Classification Models (Category)
                        </h5>
                        <div class="grid grid-cols-2 gap-3">
                `;
                
                for (const [model, prediction] of Object.entries(result.classification_predictions)) {
                    const categoryLabel = prediction <= 3 ? 'Low' : prediction <= 6 ? 'Moderate' : 'High';
                    html += `
                        <div class="bg-white p-3 rounded-md">
                            <div class="text-sm text-gray-600">${model}</div>
                            <div class="text-lg font-bold text-purple-800">${categoryLabel} (${prediction})</div>
                        </div>
                    `;
                }
                
                html += '</div></div>';
            }
            
            // Recommendations
            html += `
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h5 class="font-semibold text-gray-800 mb-3">
                        <i class="fas fa-lightbulb mr-2"></i>Recommendations
                    </h5>
                    <ul class="text-sm text-gray-600 space-y-1">
            `;
            
            const stressLevel = result.ensemble_regression || result.ensemble_classification || 5;
            if (stressLevel <= 3) {
                html += `
                    <li><i class="fas fa-check text-green-500 mr-2"></i>Maintain your current healthy lifestyle</li>
                    <li><i class="fas fa-check text-green-500 mr-2"></i>Continue regular exercise and good sleep habits</li>
                    <li><i class="fas fa-check text-green-500 mr-2"></i>Keep monitoring your stress levels</li>
                `;
            } else if (stressLevel <= 6) {
                html += `
                    <li><i class="fas fa-exclamation-triangle text-yellow-500 mr-2"></i>Consider stress management techniques</li>
                    <li><i class="fas fa-exclamation-triangle text-yellow-500 mr-2"></i>Try meditation or mindfulness exercises</li>
                    <li><i class="fas fa-exclamation-triangle text-yellow-500 mr-2"></i>Improve sleep quality and duration</li>
                    <li><i class="fas fa-exclamation-triangle text-yellow-500 mr-2"></i>Increase physical activity</li>
                `;
            } else {
                html += `
                    <li><i class="fas fa-exclamation-circle text-red-500 mr-2"></i>Consider consulting a healthcare professional</li>
                    <li><i class="fas fa-exclamation-circle text-red-500 mr-2"></i>Implement immediate stress reduction strategies</li>
                    <li><i class="fas fa-exclamation-circle text-red-500 mr-2"></i>Prioritize sleep and relaxation</li>
                    <li><i class="fas fa-exclamation-circle text-red-500 mr-2"></i>Consider professional counseling or therapy</li>
                `;
            }
            
            html += '</ul></div></div>';
            
            resultsContent.innerHTML = html;
        }
        
        function displayError(error) {
            const resultsContent = document.getElementById('results-content');
            resultsContent.innerHTML = `
                <div class="bg-red-50 p-4 rounded-lg border-l-4 border-red-500">
                    <div class="flex">
                        <i class="fas fa-exclamation-circle text-red-500 mt-1 mr-3"></i>
                        <div>
                            <h4 class="font-semibold text-red-800">Prediction Error</h4>
                            <p class="text-red-700 mt-1">${error}</p>
                        </div>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>
